# Idle RPG 프로젝트 청사진

## 1. 프로젝트 개요

**목표:** 웹 기반 방치형 RPG 게임 개발
**핵심 기능:**
- Google 계정 기반 인증
- 자동 전투 및 재화 획득
- 캐릭터 스탯 성장 시스템
- 스테이지 진행 및 몬스터 조우

## 2. 기술 스택

- **프론트엔드:** HTML, CSS, JavaScript (프레임워크 없음)
- **백엔드:** Cloudflare Workers (Functions)
- **데이터베이스:** Cloudflare D1 (SQLite 기반)
- **인증:** Google OAuth 2.0

## 3. 데이터베이스 스키마 (`users` 테이블)

- `id` (PK), `google_id`, `email`, `name`, `picture`
- `created_at`, `last_login`
- `level`, `gold`
- `str`, `dex` (기본 스탯)
- `hp`, `ap`, `crit_rate`, `crit_damage`, `attack_speed`, `evasion_rate`, `dps` (파생 스탯)
- `current_stage`, `stage_progress`

## 4. API 엔드포인트

- `GET /api/login`: Google 로그인 시작
- `GET /api/callback`: Google 로그인 콜백 처리
- `GET /api/me`: 현재 사용자 및 게임 상태 조회
- `POST /api/battle`: 전투 결과 처리
- `POST /api/upgrade`: 스탯 강화

## 5. 핵심 기능 개발 계획

### 5.1. 인증 시스템 (완료)
Google OAuth 2.0을 사용한 사용자 로그인 및 세션 관리.

### 5.2. 전투 시스템 (완료)
사용자 스탯과 몬스터 정보를 기반으로 자동 전투를 진행하고, 처치 시 보상(골드, 진행도)을 지급하며 다음 몬스터를 로드.

### 5.3. 캐릭터 스탯 강화 시스템 구현

**목표:** 사용자가 재화(골드)를 사용하여 캐릭터의 스탯을 직접 강화하는 시스템을 구현하여 성장의 재미와 전략적 선택의 깊이를 더합니다.

**세부 개발 계획:**

1.  **UI/UX 개선 (`index.html`, `style.css`, `main.js`):**
    *   **상태창 재구성:** 캐릭터 상태창(`character-stats`)을 두 부분으로 명확히 나눕니다.
        *   **파생 스탯 표시 (읽기 전용):** 상단에는 '힘'과 '민첩' 레벨에 따라 자동 계산되는 주요 파생 스탯(`HP`, `AP`, `DPS`, `치명타율`, `회피율` 등)의 현재 값을 표시합니다. 유저가 직접 강화할 수 없음을 명확히 인지시킵니다.
        *   **기본 스탯 강화 (인터랙션):** 하단에는 유저가 골드를 소모하여 직접 레벨업 할 수 있는 기본 스탯(`힘`, `민첩`)을 표시합니다. 각 항목에는 현재 레벨, 다음 레벨업에 필요한 강화 비용, 강화(+) 버튼이 포함됩니다.
    *   **스타일:** 스탯 항목, 레벨, 비용, 버튼 등을 `flexbox`를 사용하여 정렬하고 가독성을 높입니다.

2.  **스탯 강화 API 엔드포인트 생성 (`/api/upgrade.js`) (완료):**
    *   `POST /api/upgrade` API는 요청 본문으로 `{"stat": "str"}`과 같이 강화할 스탯의 종류를 받습니다.
    *   **서버 로직:**
        *   사용자 인증 후 DB에서 캐릭터 정보(골드, 스탯 레벨)를 조회합니다.
        *   서버에 정의된 강화 비용 공식(`cost = 10 * Math.pow(1.15, currentStatLevel)`)에 따라 비용을 계산합니다.
        *   사용자의 골드가 비용보다 충분한지 검증합니다.
        *   충분하다면, 골드를 차감하고 해당 스탯 레벨을 1 증가시킵니다.
        *   스탯 변경에 따른 모든 파생 스탯(`ap`, `hp`, `dps` 등)을 즉시 재계산합니다.
        *   업데이트된 모든 정보를 DB에 저장하고, 최신 캐릭터 정보를 클라이언트에 반환합니다.

3.  **클라이언트 로직 구현 (`main.js`):**
    *   강화 버튼 클릭 시, `handleUpgrade()` 함수가 실행됩니다.
    *   이 함수는 `/api/upgrade`로 강화할 스탯 정보를 담아 `POST` 요청을 보냅니다.
    *   요청이 성공하면, 서버로부터 받은 최신 캐릭터 정보로 `gameState`를 업데이트하고, `updateAllUI()`를 호출하여 화면 전체를 갱신합니다.
    *   만약 골드가 부족하면, 서버는 400 에러를 반환하고 클라이언트는 사용자에게 "골드가 부족합니다."와 같은 알림을 표시합니다.

### 5.4. (다음 기능) 장비 시스템
...
