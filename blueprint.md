# Idle RPG 프로젝트 청사진

## 1. 프로젝트 개요

**목표:** 웹 기반 방치형 RPG 게임 개발
**핵심 기능:**
- Google 계정 기반 인증
- 자동 전투 및 재화 획득 (캐릭터 사망 및 부활 시스템 포함)
- 캐릭터 스탯 성장 시스템
- 스테이지 진행 및 몬스터 조우 (10 스테이지마다 보스 출현)
- 미려하고 직관적인 UI/UX

## 2. 기술 스택

...

## 5. 핵심 기능 개발 계획

...

### 5.5. 보스 출현 규칙 변경 (완료)

### 5.6. 캐릭터 사망 및 부활 시스템

**목표:** 몬스터가 캐릭터를 공격하는 시스템을 도입하고, 캐릭터의 체력이 0이 되면 사망하며 그에 따른 페널티를 부여하여 게임의 긴장감과 전략적 요소를 더합니다.

**세부 개발 계획:**

1.  **몬스터 데이터 확장 (`functions/game/monster-data.js`):**
    *   모든 몬스터 객체에 `ap` (공격력) 및 `attack_speed` (초당 공격 횟수) 속성을 추가합니다.

2.  **사망 처리 API 엔드포인트 생성 (`functions/api/defeat.js`):**
    *   `POST /api/defeat` 요청을 처리할 새로운 API 파일을 생성합니다.
    *   요청 수신 시, 데이터베이스에서 해당 유저 정보를 조회합니다.
    *   **사망 페널티 적용:**
        *   `current_stage`를 1 감소시킵니다 (최소값 1).
        *   `stage_progress`를 0으로 초기화합니다.
        *   `gold`를 10% 감소시킵니다.
    *   업데이트된 유저 정보를 데이터베이스에 저장합니다.
    *   변경된 캐릭터 정보와 새로운 스테이지의 몬스터 정보를 응답으로 반환합니다.

3.  **프론트엔드 전투 로직 수정 (`public/main.js`):**
    *   `gameState`에 `character.currentHp`와 `monster.attackProgress`를 추가하여 상태를 관리합니다.
    *   `battleLoop` 함수를 수정하여 매 틱마다 다음을 수행합니다:
        *   (기존) 몬스터의 HP를 플레이어의 DPS만큼 감소시킵니다.
        *   (추가) 몬스터의 `attackProgress`를 누적시키고, 1 이상이 되면 플레이어의 `currentHp`를 몬스터의 `ap`만큼 감소시킨 후 `attackProgress`를 1 차감합니다.
    *   **사망 판정:** `currentHp`가 0 이하가 되면 `handleDefeat` 함수를 호출합니다.
    *   `handleDefeat` 함수를 새로 구현합니다:
        *   전투를 중지하고 `/api/defeat` API를 호출합니다.
        *   응답으로 받은 새 캐릭터 정보와 몬스터 정보로 `gameState`를 업데이트합니다.
        *   캐릭터의 `currentHp`를 최대 HP로 재설정하고 전투를 다시 시작합니다.
    *   `handleVictory` 함수를 수정하여, 전투 승리 시에도 `currentHp`를 최대 HP로 회복시킵니다.

4.  **UI 요소 추가 (`public/index.html`, `public/style.css`):**
    *   캐릭터 정보 패널(`character-panel`)에 플레이어의 HP 바를 추가하여 현재 체력 상태를 시각적으로 표시합니다.

### 5.7. (다음 기능) 장비 시스템
...
