# Idle RPG 프로젝트 청사진

(이전 내용은 동일하게 유지)

### 5.3. 캐릭터 스탯 강화 시스템 구현 (진행 중)

**목표:** 사용자가 재화(골드)를 사용하여 캐릭터의 스탯을 직접 강화하는 시스템을 구현하여 성장의 재미와 전략적 선택의 깊이를 더합니다.

**세부 개발 계획:**

1.  **UI/UX 개선 (`index.html`, `style.css`):**
    *   `index.html`: 캐릭터 상태창(`character-stats`)에 각 스탯 항목을 개별 `div`로 감싸고, 현재 스탯 레벨, 강화 비용, 그리고 강화(`+`) 버튼을 추가할 구조를 만듭니다.
    *   `style.css`: 스탯 강화 버튼(`upgrade-button`)에 대한 스타일(크기, 색상, 호버 효과)을 추가하여 사용자가 쉽게 누를 수 있도록 디자인합니다. 강화 비용 텍스트 스타일도 추가합니다.

2.  **스탯 강화 API 엔드포인트 생성 (`/api/upgrade.js`):**
    *   `POST /api/upgrade` API를 새로 생성합니다. 이 API는 요청 본문으로 `{"stat": "str"}`과 같이 강화할 스탯의 종류를 받습니다.
    *   **서버 로직:**
        *   사용자 인증을 거친 후, DB에서 현재 캐릭터의 정보(골드, 강화할 스탯의 현재 레벨 등)를 조회합니다.
        *   강화 비용 공식을 서버에서 정의합니다. (예: `cost = 10 * Math.pow(1.1, currentStatLevel)`) 이를 통해 클라이언트의 조작을 방지합니다.
        *   사용자의 골드가 강화 비용보다 충분한지 검증합니다.
        *   조건이 맞으면, 사용자의 골드를 차감하고 해당 스탯 레벨을 1 증가시킵니다.
        *   스탯 변경에 따라 영향을 받는 파생 스탯(예: `ap`, `hp`, `dps` 등)을 즉시 재계산합니다.
        *   업데이트된 모든 정보를 DB에 저장합니다.
        *   강화 성공 여부와 함께 최신 캐릭터 정보를 클라이언트에 반환합니다.

3.  **프론트엔드 연동 로직 (`main.js`):**
    *   `updateCharacterUI` 함수를 대폭 수정합니다. 이제 단순히 텍스트를 표시하는 것을 넘어, 서버에서 받은 스탯 데이터를 기반으로 각 스탯별 강화 UI(레벨, 비용, 버튼)를 동적으로 렌더링합니다.
    *   상태창(`character-stats`)에 이벤트 위임을 사용하여 `.upgrade-button` 클릭 이벤트를 감지합니다.
    *   버튼 클릭 시, 해당 버튼의 `data-stat` 속성을 읽어와 `/api/upgrade` API로 강화 요청을 보냅니다.
    *   요청이 성공하면 서버가 반환한 최신 캐릭터 데이터로 `gameState.character`를 업데이트하고, `updateAllUI`를 호출하여 화면 전체(골드, 스탯, DPS 등)를 즉시 새로고침합니다.
    *   만약 골드가 부족하여 강화에 실패하면, 사용자에게 피드백(예: 버튼 비활성화 또는 간단한 알림)을 제공합니다.

(이하 이전 계획들은 순서대로 유지)
