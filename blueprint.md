# Idle RPG 프로젝트 청사진

이 문서는 Idle RPG 프로젝트의 개발 계획, 아키텍처, 디자인 원칙 및 구현 단계를 기록하는 중앙 허브 역할을 합니다.

## 1. 애플리케이션 개요

**Idle RPG**는 사용자가 최소한의 조작으로 캐릭터를 성장시키는 방치형 웹 게임입니다. 사용자는 Google 계정으로 로그인하고, 캐릭터는 자동으로 몬스터와 싸우며 성장합니다. 이 프로젝트는 Cloudflare Pages에 배포되며, 정적 프론트엔드와 서버리스 Functions API를 결합한 현대적인 웹 아키텍처를 사용합니다.

## 2. 핵심 기능

- **Google 계정 기반 인증:** Cloudflare Pages Functions를 이용한 안전한 OAuth 2.0 로그인.
- **자동 전투 시스템:** 사용자가 보고 있지 않아도 캐릭터는 계속해서 전투하고 재화를 획득합니다.
- **캐릭터 성장:** 전투를 통해 경험치와 골드를 획득하여 레벨업하고 능력치를 강화합니다.
- **실시간 데이터 동기화:** Cloudflare D1 데이터베이스를 사용하여 모든 사용자 데이터를 저장하고 동기화합니다.

## 3. 기술 스택

- **프론트엔드:** 순수 HTML, CSS, JavaScript (프레임워크 없음)
- **백엔드 (API):** Cloudflare Pages Functions (JavaScript)
- **데이터베이스:** Cloudflare D1 (SQLite 기반 서버리스 데이터베이스)
- **인증:** Google OAuth 2.0
- **배포:** Cloudflare Pages
- **개발 환경:** Firebase Studio IDE

## 4. 구현 및 디버깅 기록

이 섹션은 프로젝트 개발 중 발생했던 주요 문제들과 해결 과정을 시간 순서대로 기록합니다.

### 4.1. ~ 4.3. (이전 기록 생략)

### 4.4. UI/UX 개선: 로그인/게임 화면 분리
- **목표:** 사용자가 로그인 상태를 명확하게 인지할 수 있도록 UI를 개선합니다.
- **구현:** `index.html`, `style.css`, `main.js`를 수정하여 로그인 상태에 따라 다른 뷰를 동적으로 표시하도록 구현했습니다.
- **주요 문제:** API(`/api/me`)가 반환하는 데이터 구조와 프론트엔드(`main.js`)가 기대하는 데이터 구조가 달라 로그인 후에도 화면이 제대로 표시되지 않는 무한 루프 발생.
- **해결:** `/api/me`의 응답을 프론트엔드가 기대하는 `{"user": {...}, "character": {...}}` 구조로 수정하여 해결했습니다.

### 4.5. 버그 수정 및 기능 확장: 캐릭터 스탯 시스템
- **목표:** 캐릭터 스탯이 `undefined`로 표시되는 버그를 수정하고, 더 상세한 스탯 정보를 제공합니다.
- **근본 원인 (버그):** 신규 사용자 생성 시(`callback.js`), 캐릭터의 기본 스탯(레벨, 골드 등)이 초기화되지 않아 데이터베이스에 `NULL`로 저장되었음. 이 값이 프론트엔드에 `undefined`로 표시됨.
- **구현 계획:**
  1.  **DB 스키마 확장:** `users` 테이블에 `hp`, `ap`, `def`, `crit_rate`, `crit_damage`, `attack_speed`, `evasion_rate` 컬럼을 추가합니다. 모든 스탯 컬럼에 `NOT NULL`과 `DEFAULT` 제약 조건을 설정합니다.
  2.  **스탯 초기화 로직 수정 (`callback.js`):** `INSERT` 쿼리를 수정하여 신규 사용자 생성 시 모든 스탯에 대한 기본값을 명시적으로 제공합니다.
  3.  **API 응답 확장 (`me.js`):** 새로 추가된 모든 스탯을 `/api/me` 응답에 포함시킵니다.
  4.  **UI 개선 (`main.js`):** 캐릭터 정보 창을 재구성하여 모든 상세 스탯이 올바르게 표시되도록 합니다.

## 5. 향후 개발 계획: 자동 전투 시스템

... (이하 생략)
